# 실시간 JPEG2000 손실 압축 POC 최종 보고서

## 프로젝트 개요

DICOM 파일 다운로드 시 JPEG2000 실시간 압축을 통해 **대역폭을 절약**하고 **전송 효율성을 높이는** POC 프로젝트입니다.

### 목표

- 원본 다운로드 성능(13-16초) 대비 **합리적인 시간 내** JPEG2000 압축 제공
- 대역폭 사용량 대폭 감소를 통한 **네트워크 비용 절감**
- 의료 영상 품질 손실 최소화

---

## 핵심 결과 요약

### 기술적 성과

- **5가지 압축 라이브러리** 구현 및 성능 검증 완료
- **실시간 JPEG2000 압축** 기술적 구현 성공
- **최대 545배 압축률** 달성 (대역폭 99.8% 절약)

### 실용성 한계

- **원본 대비 2-4배 처리 시간** 증가 (13초 → 23-48초)
- **물리적 한계**: S3 다운로드(8-10초) + 압축(3-5초) + 전송(2-3초) = **최소 13-18초**
- **사용자 경험 저하**: 압축으로 인한 대기 시간 증가

---

## 성능 비교 결과

| 압축 방식         | 처리 시간          | 압축률  | 상태         | 비고                   |
| ----------------- | ------------------ | ------- | ------------ | ---------------------- |
| **원본 (ZIP)**    | **13-16초** (기준) | 1.83배  | ✅ **기준**  | EC2 환경 기준          |
| **gdcmconv**      | 43초 (+27초)       | 545.3배 | ✅ 완료      | 최고 압축률, 너무 느림 |
| **dcmjs-codecs**  | 48.34초 (+32.34초) | 240배   | ❌ 너무 느림 | 최종 구현, EC2 환경    |
| **openjpeg-wasm** | 27초 (+11초)       | 1.86배  | ❌ 실패      | 압축률 극히 낮음       |
| **dicom-codec**   | -                  | 1배     | ❌ 압축 안됨 | 기술적 문제            |

### 핵심 인사이트

- **물리적 한계**: 실시간 압축으로는 **13초 이하 불가능**
- **트레이드오프**: 높은 압축률 ↔ 긴 처리 시간
- **실제 성능**: 최종 dcmjs-codecs 구현에서 48.34초 소요 (원본 대비 3배 느림)
- **모든 테스트**: EC2 환경에서 실제 운영 조건 검증

---

## 최종 권장 솔루션

### 사전 압축 + CloudFront 방식 (권장)

#### 구현 방법

1. **사전 압축**: CT 스캔 완료 시 Rate 100으로 JPEG2000 압축
   - **Rate 100 선택 근거**: 70.3배 압축률, 육안으로 원본과 차이 거의 없음
   - **의료적 적합성**: 진단용 제한, Preview용으로 충분히 사용 가능
   - **품질 평가**: PSNR 39.5dB, SSIM 0.9365로 양호한 구조적 유사성
2. **S3 저장**: 압축된 파일을 ZIP 형태로 S3에 저장
3. **CloudFront 배포**: CDN을 통한 고속 전송

#### 예상 성능

**압축률 데이터 (실측)**:

- **원본**: 106.9MB
- **Rate 10**: 20.1MB (5.3배 압축)
- **Rate 100**: 2.5MB (42.8배 압축)

**다운로드 시간 계산**:

```
원본 다운로드: 16초 (106.9MB)
Rate 100 압축: 16초 × (2.5MB ÷ 106.9MB) = 0.37초
CloudFront 캐싱 고려: 약 1-2초
```

- **다운로드 시간**: **1-2초** (현재 대비 8-16배 빠름)
- **파일 크기**: 106.9MB → 2.5MB (97.7% 절약)
- **사용자 경험**: 거의 즉시 다운로드

#### 비즈니스 효과

- **네트워크 비용**: 97.7% 절감 (106.9MB → 2.5MB)
- **사용자 만족도**: 대폭 향상 (16초 → 1-2초)
- **시스템 부하**: 실시간 압축 부하 제거
- **의료 활용성**: Preview, 환자 상담, 원격의료에 적합
- **품질 보장**: 형태 식별 완벽, 육안상 원본과 구분 어려움

---

## 기술적 분석

### 실시간 압축의 한계

#### 물리적 병목

```
S3 다운로드: 8-10초 (네트워크 I/O, 고정)
압축 처리:   3-5초  (CPU 집약적, 최소)
ZIP + 전송:  2-3초  (메모리/네트워크, 고정)
─────────────────────────────────────
물리적 최소: 13-18초
```

#### 압축 알고리즘 특성

- **JPEG2000**: 고품질 의료 영상용, CPU 집약적
- **높은 압축률**: 복잡한 웨이블릿 변환 필요
- **실시간 처리**: 압축률과 속도는 반비례 관계

### 테스트된 라이브러리들

#### 1. gdcmconv (GDCM)

- **장점**: 의료 표준 라이브러리, 최고 압축률 (545배)
- **단점**: 외부 프로세스 오버헤드, 43초 소요
- **결론**: 높은 압축률이지만 실용성 부족

#### 2. dcmjs-codecs (WebAssembly)

- **장점**: 순수 JavaScript, 240배 압축률
- **단점**: EC2 환경에서 48.34초 소요, 원본 대비 3배 느림
- **결론**: 최종 구현에서도 실용성 부족

#### 3. openjpeg-wasm

- **장점**: 빠른 처리 (27초)
- **단점**: 압축률 극히 낮음 (1.86배)
- **결론**: 압축 효과 없어 의미 없음

---

## 최종 결론 및 권고사항

### 핵심 결론

1. **실시간 JPEG2000 압축은 기술적으로 가능하지만 실용성이 없음**

   - 물리적 한계로 인해 13초 이하 달성 불가능
   - 사용자 경험 저하 (2-4배 처리 시간 증가)

2. **사전 압축 + CloudFront 방식이 최적 솔루션**
   - 다운로드 시간: 16초 → 1-2초 (8-16배 개선)
   - 파일 크기: 106.9MB → 2.5MB (97.7% 절약)
   - 사용자 만족도: 대폭 향상

