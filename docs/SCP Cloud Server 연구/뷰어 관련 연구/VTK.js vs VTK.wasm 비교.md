# 3D Web Viewer: VTK.js vs VTK.wasm 비교

## 목적과 범위

- 본 문서는 3D 볼륨 기반 Web Viewer에 대해 VTK.js를 계속 사용할지, VTK.wasm으로 전환/병행할지 사전 검토한다.
- 데모/구현은 추후 단계에서 수행하고, 여기서는 기술 성숙도, 적용 가능성, 리스크, PoC 체크리스트만 정리한다.

## 배경

- 과거 VTK.wasm은 기능/안정성 측면에서 3D 볼륨 렌더링에 충분치 않아 VTK.js를 채택했음.
- 최근 배포 페이지와 JS 가이드를 보면 VTK.wasm이 적극적으로 업데이트되고, JS에서 직접 활용 가능한 렌더링 스택을 제공하고 있음([Activities | VTK.wasm][ref-activities], [VTK.wasm JS 가이드][ref-js-guide]).

## 기술 개요

### VTK.js

- 순수 JS/TS로 작성된 VTK 포팅. 브라우저 친화적이며 생태계/사용 예가 풍부.
- 3D 볼륨/이미지 슬라이스/상호작용 위젯 등 의료 영상 뷰잉에 다수 사례가 존재.

### VTK.wasm

- C++ VTK를 WebAssembly로 번들링하여 브라우저/서버(예: JS 런타임)에서 활용 가능.
- JS에서 `vtk` 네임스페이스로 객체를 생성/조작하고, 렌더러/윈도우/인터랙터를 구성하는 흐름을 제공([VTK.wasm JS 가이드][ref-js-guide]).
- 현재 가이드에 따르면 폴리데이터/매퍼/액터 중심으로 WASM 번들이 구성되어 있으며, 커버리지를 확대 예정이라고 명시되어 있음([VTK.wasm JS 가이드][ref-js-guide]).

## 기능/적용성 비교(요지)

- 렌더링 커버리지

  - VTK.js: 폴리데이터/볼륨 렌더링(라이트/카메라/샤이딩/전이함수 등) 사례 다수.
  - VTK.wasm: 가이드 상 폴리데이터 위주 예제와 설명이 중심. 볼륨 렌더링 클래스 지원 범위는 번들/버전에 따라 상이할 수 있음. [논의 필요] 실제 번들에서 볼륨 렌더링 파이프라인(예: `vtkImageData`, 볼륨 매퍼, 전이함수) 사용 가능 여부 확인.

- 상호작용/위젯

  - VTK.js: 마우스/터치 인터랙션, 3D 위젯 사례 풍부.
  - VTK.wasm: 렌더 윈도우/인터랙터 구성은 가능하나, 위젯/툴킷 커버리지는 번들 구성에 의존. [논의 필요] 필수 위젯(윈도우레벨, 자르기/크로핑, 측정 등) 대응 방안.

- 생태계 및 배포

  - VTK.js: NPM 기반 생태계/문서 풍부.
  - VTK.wasm: 사전 빌드된 WASM 번들을 활용하거나, 자체 빌드/커스터마이징 가능. JS에서 ESM/UMD/Plain Script 등 다양한 통합 경로를 제공([VTK.wasm JS 가이드][ref-js-guide]). 번들 크기/초기 로드 지연은 사전 측정 필요. [논의 필요]

- 서버/클라이언트 활용
  - VTK.js: 브라우저 클라이언트 중심.
  - VTK.wasm: 브라우저와 서버(일부 환경)에서 활용 가능성이 열려 있음(가이드에 “servers and clients” 언급). 서버 사이드 WASM 렌더링의 실효성/자원 제약은 별도 PoC 필요. [논의 필요]

## 아키텍처/운영 고려사항

- 초기 로드 성능: WASM 번들/에셋 크기, 캐싱/HTTP2/압축 전략 필요. [논의 필요]
- 모바일 최적화: 저사양 단말에서 3D 볼륨 인터랙션 프레임레이트 검증 필요.
- 기능 간극: VTK.wasm 번들에서 요구 클래스 미지원 시 대안(커스텀 빌드, 하이브리드 구성) 필요.
- 이행 전략: 완전 전환이 아닌, 페이지/기능 단위 병행 운영(하이브리드)을 1차 목표로 설정 가능.

## PoC 체크리스트(제안)

1. 기능 검증

   - 볼륨 렌더링 가능 여부: `vtkImageData` 로딩, 볼륨 매퍼/액터, 전이함수/조명 적용.
   - 슬라이스/재형상(orthogonal, oblique) 상호작용.
   - 카메라/조작(모바일 터치 포함) 유연성 확인.

2. 성능/자원

   - 데스크톱/모바일에서 512³ CT 기준 FPS/메모리 측정.
   - 초기 로드 시간(WASM 다운로드/초기화), 상호작용 지연, GC/안정성.

3. 번들/통합

   - ESM/번들러 통합, 코드 스플리팅, 캐싱 전략.
   - 우리 뷰어 프레임워크와 이벤트/상태 관리 연계.

4. 리스크/대응
   - 미지원 기능 식별 시 커스텀 빌드 가능성/노력도 평가.
   - 하이브리드 전략: 핵심은 VTK.js 유지, 특정 뷰/기능에서 VTK.wasm 시험 적용.

## 초기 결론(초안)

- VTK.wasm은 최근 활발히 업데이트되며, JS에서 직접 렌더링 스택을 다루는 경로를 제공한다는 점에서 적용 가능성이 높아졌다([Activities][ref-activities], [JS 가이드][ref-js-guide]).
- 다만 가이드가 폴리데이터 중심으로 기술되어 있어, “현재 번들에서의 3D 볼륨 렌더링 지원 범위”는 POC로 즉시 확인해야 한다. [논의 필요]
- 권고: 단기에는 VTK.js 기반을 유지하되, VTK.wasm을 특정 페이지/기능(예: 경량 3D 프리뷰)에서 파일럿 적용하는 하이브리드 접근을 제안한다. PoC 결과에 따라 점진 전환 여부를 재평가한다.

## 참고

- [Activities | VTK.wasm][ref-activities]
- [VTK.wasm from the JavaScript side][ref-js-guide]

[ref-activities]: https://kitware.github.io/vtk-wasm/
[ref-js-guide]: https://kitware.github.io/vtk-wasm/guide/js/
